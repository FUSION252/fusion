<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>F√™nix ‚Ä¢ Iara Player</title>
<style>
  :root{
    --bg:#0b0b0e; --card:#121219; --ink:#e7e7ef; --muted:#a7a7bd; --accent:#8a5cff;
    --accent2:#43d3b6; --danger:#ff5c7a;
  }
  *{box-sizing:border-box}
  body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,'Helvetica Neue',Arial;
       background:linear-gradient(180deg,#0a0a10 0%, #0c0c14 60%, #0f0f17 100%);
       color:var(--ink)}
  .topbar{
    position:sticky;top:0;z-index:50;
    display:flex;align-items:center;gap:.8rem;
    padding:.9rem 1rem;background:rgba(10,10,16,.9);backdrop-filter:blur(6px);
    border-bottom:1px solid rgba(255,255,255,.06)
  }
  .logo{
    display:flex;align-items:center;gap:.6rem;font-weight:700;letter-spacing:.3px
  }
  .badge{font-size:.75rem;padding:.18rem .5rem;border-radius:999px;background:rgba(138,92,255,.18);color:#cab6ff}
  .shell{max-width:1100px;margin:1rem auto;padding:0 1rem}
  .player-card{background:var(--card);border:1px solid rgba(255,255,255,.06);
    border-radius:18px;overflow:hidden;box-shadow:0 10px 30px rgba(0,0,0,.35)}
  .player-wrap{position:relative;aspect-ratio:16/9;background:#000}
  #player{position:absolute;inset:0}
  .controls{
    display:flex;flex-wrap:wrap;gap:.5rem;align-items:center;justify-content:space-between;
    padding:.7rem .9rem;border-top:1px solid rgba(255,255,255,.06);background:rgba(0,0,0,.25)
  }
  .btn{
    display:inline-flex;align-items:center;gap:.45rem;
    padding:.6rem .85rem;border:1px solid rgba(255,255,255,.08);
    background:rgba(255,255,255,.03);color:var(--ink);cursor:pointer;border-radius:12px;
    user-select:none;transition:.15s transform ease, .15s background ease
  }
  .btn:hover{background:rgba(255,255,255,.07)}
  .btn:active{transform:translateY(1px)}
  .btn.primary{background:linear-gradient(135deg,var(--accent),#6b44ff);border-color:transparent}
  .btn.danger{background:linear-gradient(135deg,var(--danger),#ff2f66);border-color:transparent}
  .row{display:flex;flex-wrap:wrap;gap:.6rem;align-items:center}
  .input{
    flex:1;min-width:220px;display:flex;align-items:center;gap:.5rem;background:rgba(255,255,255,.04);
    border:1px solid rgba(255,255,255,.08);border-radius:12px;padding:.5rem .7rem
  }
  .input input{flex:1;background:transparent;border:0;outline:0;color:var(--ink);font-size:.95rem}
  .hint{color:var(--muted);font-size:.85rem}
  .grid{display:grid;gap:1rem;margin-top:1rem}
  @media(min-width:900px){ .grid{grid-template-columns:1.3fr .7fr} }
  .panel{background:var(--card);border:1px solid rgba(255,255,255,.06);border-radius:18px;padding:1rem}
  .panel h3{margin:.2rem 0  .7rem 0;font-size:1rem;color:#dcdcf3}
  .log{
    height:180px;overflow:auto;background:rgba(0,0,0,.25);border:1px dashed rgba(255,255,255,.12);
    border-radius:12px;padding:.6rem;font-family:ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
    font-size:.9rem;line-height:1.35;color:#d9e2ff
  }
  .vol{display:flex;align-items:center;gap:.6rem}
  input[type="range"]{width:150px}
  .pill{font-size:.8rem;color:#cfe; background:rgba(67,211,182,.18); padding:.2rem .5rem; border-radius:999px}
  .footer{opacity:.8;text-align:center;margin:1rem 0 2rem}
</style>
</head>
<body>
  <div class="topbar">
    <div class="logo">
      <svg width="26" height="26" viewBox="0 0 24 24" fill="none"><path d="M12 2l2.39 4.847 5.35.777-3.87 3.77.913 5.324L12 14.77l-4.783 2.948.913-5.324-3.87-3.77 5.35-.777L12 2z" stroke="#8a5cff" stroke-width="1.2" fill="none"/></svg>
      <span>F√™nix</span><span class="badge">Iara ‚Ä¢ IA integrada</span>
    </div>
  </div>

  <div class="shell">
    <div class="player-card">
      <div class="player-wrap">
        <div id="player"></div>
      </div>
      <div class="controls">
        <div class="row">
          <button class="btn" id="prevBtn">‚èÆÔ∏è Anterior</button>
          <button class="btn primary" id="playBtn">‚ñ∂Ô∏è Reproduzir</button>
          <button class="btn" id="pauseBtn">‚è∏Ô∏è Pausar</button>
          <button class="btn" id="nextBtn">‚è≠Ô∏è Pr√≥ximo</button>
          <button class="btn" id="muteBtn">üîá Mudo</button>
          <div class="vol">
            <span class="hint">üîä</span>
            <input type="range" id="vol" min="0" max="100" value="80" />
            <span class="hint" id="volVal">80%</span>
          </div>
          <button class="btn" id="fsBtn">‚õ∂ Tela inteira</button>
        </div>
        <div class="row" style="flex:1">
          <div class="input" title="Buscar no YouTube e tocar aqui">
            <span>üîé</span>
            <input id="search" placeholder="Buscar e tocar (ex: m√∫sicas relaxantes)" />
          </div>
          <button class="btn" id="searchBtn">Buscar & Tocar</button>
        </div>
      </div>
    </div>

    <div class="grid">
      <div class="panel">
        <h3>Iara (texto ou voz) <span class="pill">comandos naturais</span></h3>
        <div class="row">
          <div class="input" title='Ex: "Iara, tocar Legi√£o Urbana", "Iara, pr√≥ximo", "Iara, volume 60"'>
            <span>üí¨</span>
            <input id="cmd" placeholder='Diga: "Iara, tocar m√∫sica para dormir"‚Ä¶' />
          </div>
          <button class="btn" id="runCmd">Executar</button>
          <button class="btn" id="micBtn">üé§ Falar</button>
        </div>
        <p class="hint" style="margin:.6rem 0 0 0">
          Exemplos: <em>Iara, tocar rock nacional</em> ‚Ä¢ <em>Iara, pausar</em> ‚Ä¢ <em>Iara, pr√≥ximo</em> ‚Ä¢ <em>Iara, volume 40</em> ‚Ä¢ <em>Iara, voltar</em>
        </p>
      </div>

      <div class="panel">
        <h3>Di√°logo / Status</h3>
        <div id="log" class="log"></div>
      </div>
    </div>

    <div class="footer hint">Feito com carinho por n√≥s dois ‚Ä¢ F√™nix + Iara üíú</div>
  </div>

  <!-- YouTube IFrame API -->
  <script>
    // ===== Util =====
    const $ = (sel)=>document.querySelector(sel);
    const log = (msg)=>{ const box=$("#log"); const t=new Date().toLocaleTimeString(); box.innerHTML += `[${t}] ${msg}<br/>`; box.scrollTop=box.scrollHeight; };

    // ===== Player =====
    let player, currentQuery = "m√∫sicas relaxantes";
    let isMuted = false;

    function onYouTubeIframeAPIReady(){
      player = new YT.Player('player', {
        height: '100%',
        width: '100%',
        // Carrega uma "playlist de pesquisa" sem precisar de API key:
        playerVars: { modestbranding:1, rel:0, controls:1, fs:1, iv_load_policy:3, color:'white', listType:'search', list: currentQuery },
        events: {
          'onReady': onPlayerReady,
          'onError': (e)=>log("Erro no player: "+e.data)
        }
      });
    }
    function onPlayerReady(){
      log("Player pronto. Buscando: " + currentQuery);
      player.setVolume(80);
    }

    // ===== Controles =====
    $("#playBtn").onclick = ()=>{ player && player.playVideo(); log("‚ñ∂Ô∏è Reproduzir"); };
    $("#pauseBtn").onclick = ()=>{ player && player.pauseVideo(); log("‚è∏Ô∏è Pausar"); };
    $("#nextBtn").onclick = ()=>{ player && player.nextVideo(); log("‚è≠Ô∏è Pr√≥ximo"); };
    $("#prevBtn").onclick = ()=>{ player && player.previousVideo(); log("‚èÆÔ∏è Anterior"); };
    $("#muteBtn").onclick = ()=>{
      if(!player) return;
      isMuted ? (player.unMute(), log("üîä Som ativado")) : (player.mute(), log("üîá Som desativado"));
      isMuted = !isMuted;
    };
    $("#vol").oninput = (e)=>{ const v=+e.target.value; $("#volVal").textContent = v+"%"; if(player) player.setVolume(v); };
    $("#fsBtn").onclick = ()=>{
      const card = document.querySelector(".player-wrap");
      if(document.fullscreenElement){ document.exitFullscreen(); }
      else { card.requestFullscreen?.(); }
    };

    // ===== Busca direta =====
    function searchAndPlay(q){
      if(!q || !player) return;
      currentQuery = q;
      // Troca a "lista por busca": playlist din√¢mica com resultados da pesquisa
      player.loadPlaylist({ listType:'search', list:q, index:0, startSeconds:0, suggestedQuality:'default' });
      log("üîé Tocando resultados para: " + q);
    }
    $("#searchBtn").onclick = ()=> searchAndPlay($("#search").value.trim());
    $("#search").addEventListener('keydown', (e)=>{ if(e.key==='Enter') $("#searchBtn").click(); });

    // ===== Iara (texto) =====
    $("#runCmd").onclick = ()=> handleCommand( $("#cmd").value.trim() );
    $("#cmd").addEventListener('keydown', (e)=>{ if(e.key==='Enter') $("#runCmd").click(); });

    function handleCommand(raw){
      if(!raw){ log("Iara: diga algo como ‚ÄúIara, tocar ‚Ä¶‚Äù"); return; }
      const txt = raw.toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g,'').trim();
      log("Voc√™: " + raw);

      // remove "iara" no in√≠cio, se houver
      const cleaned = txt.replace(/^iara[, ]*/,'').trim();

      // Inten√ß√µes simples
      if(/^paus(ar)?$/.test(cleaned) || cleaned.includes("pausar")) { player?.pauseVideo(); log("Iara: pausando."); return; }
      if(/^play$/.test(cleaned) || cleaned.includes("tocar") || cleaned.includes("reproduzir")) {
        // "tocar X" -> busca e toca
        const m = cleaned.match(/tocar|reproduzir/);
        const q = cleaned.slice((m?.index ?? 0) + (m?.[0].length ?? 0)).trim();
        if(q){ searchAndPlay(q); log(`Iara: procurando e tocando ‚Äú${q}‚Äù.`); }
        else { player?.playVideo(); log("Iara: reproduzindo."); }
        return;
      }
      if(cleaned.includes("proximo") || cleaned.includes("pr√≥ximo")) { player?.nextVideo(); log("Iara: pr√≥ximo v√≠deo."); return; }
      if(cleaned.includes("anterior") || cleaned.includes("voltar")) { player?.previousVideo(); log("Iara: v√≠deo anterior."); return; }

      const volMatch = cleaned.match(/volume\s*(\d{1,3})/);
      if(volMatch){
        let v = Math.max(0, Math.min(100, parseInt(volMatch[1],10)));
        player?.setVolume(v); $("#vol").value=v; $("#volVal").textContent=v+"%";
        log(`Iara: volume em ${v}%.`); return;
      }

      // "abrir <id/url>"
      if(cleaned.startsWith("abrir ")){
        const rest = cleaned.replace("abrir","").trim();
        // extrai id do YouTube se for URL
        const id = extractYouTubeId(rest);
        if(id){ player?.loadVideoById(id); log("Iara: abrindo v√≠deo solicitado."); }
        else { searchAndPlay(rest); }
        return;
      }

      // fallback: trata como busca
      searchAndPlay(cleaned);
      log(`Iara: entend√≠ como busca por ‚Äú${cleaned}‚Äù.`);
    }

    function extractYouTubeId(text){
      try{
        const url = new URL(text);
        if(url.hostname.includes("youtube.com")) return url.searchParams.get("v");
        if(url.hostname.includes("youtu.be")) return url.pathname.slice(1);
      }catch(_){}
      // talvez j√° seja um ID
      if(/^[\w-]{11}$/.test(text)) return text;
      return null;
    }

    // ===== Iara (voz) =====
    let rec, listening=false;
    function supportsSpeech(){
      return 'webkitSpeechRecognition' in window || 'SpeechRecognition' in window;
    }
    if(supportsSpeech()){
      const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
      rec = new SR();
      rec.lang = 'pt-BR';
      rec.interimResults = false;
      rec.maxAlternatives = 1;
      rec.onresult = (e)=>{
        const said = e.results[0][0].transcript;
        $("#cmd").value = said;
        log("üé§ Voc√™ disse: " + said);
        handleCommand(said);
      };
      rec.onend = ()=>{ listening=false; $("#micBtn").textContent = "üé§ Falar"; log("üé§ microfone parado."); };
      rec.onerror = (e)=>{ listening=false; $("#micBtn").textContent = "üé§ Falar"; log("‚ö†Ô∏è Erro no microfone: "+ e.error); };
    } else {
      $("#micBtn").disabled = true;
      $("#micBtn").title = "Seu navegador n√£o suporta reconhecimento de voz";
    }
    $("#micBtn").onclick = ()=>{
      if(!rec){ log("‚ö†Ô∏è Voz n√£o suportada neste navegador."); return; }
      if(listening){ rec.stop(); return; }
      listening = true; $("#micBtn").textContent = "üõë Parar";
      log("üé§ ouvindo‚Ä¶ fale um comando para a Iara.");
      rec.start();
    };

    // ===== Carregamento do script do YouTube API =====
    (function loadYT(){
      const tag = document.createElement('script');
      tag.src = "https://www.youtube.com/iframe_api";
      document.head.appendChild(tag);
    })();
  </script>
</body>
</html>
