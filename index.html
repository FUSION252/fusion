<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>F√™nix ‚Ä¢ Builder (AIDE + Termux em 1)</title>
<link rel="preconnect" href="https://cdn.jsdelivr.net">
<style>
:root{
  --bg:#0b0b10;--card:#12131a;--ink:#f2f3f7;--muted:#a9adc2;--accent:#7c5cff;--ok:#42d3b6;--warn:#ffb65c;--err:#ff5c7a;
}
*{box-sizing:border-box} body{margin:0;background:radial-gradient(1200px 600px at 20% -10%,#181a25 0,#0b0b10 60%);color:var(--ink);
font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial}
.top{position:sticky;top:0;z-index:20;display:flex;align-items:center;gap:.8rem;padding:.9rem 1rem;background:rgba(10,10,14,.8);backdrop-filter:blur(6px);border-bottom:1px solid rgba(255,255,255,.06)}
.logo{display:flex;align-items:center;gap:.6rem;font-weight:700;letter-spacing:.2px}
.badge{font-size:.75rem;padding:.18rem .5rem;border-radius:999px;background:rgba(124,92,255,.18);color:#dacfff}
.shell{max-width:1100px;margin:1rem auto;padding:0 1rem}
.card{background:var(--card);border:1px solid rgba(255,255,255,.06);border-radius:18px;padding:1rem 1.1rem;box-shadow:0 10px 30px rgba(0,0,0,.35)}
.grid{display:grid;gap:1rem}.two{grid-template-columns:1.2fr .8fr}
h2{margin:.3rem 0 1rem 0;font-size:1.15rem;color:#e9e9ff}
.row{display:flex;gap:.7rem;align-items:center;flex-wrap:wrap}
label{font-size:.9rem;color:#d7d7ef}
input,select,textarea{width:100%;padding:.6rem .7rem;border-radius:12px;border:1px solid rgba(255,255,255,.08);background:rgba(255,255,255,.04);color:var(--ink);outline:0}
small{color:var(--muted)}
.btn{display:inline-flex;align-items:center;gap:.45rem;padding:.7rem 1rem;border-radius:12px;border:1px solid rgba(255,255,255,.08);background:rgba(255,255,255,.05);color:var(--ink);cursor:pointer;user-select:none}
.btn:hover{background:rgba(255,255,255,.08)} .btn.primary{background:linear-gradient(135deg,var(--accent),#5b44ff);border-color:transparent}
.btn.ok{background:linear-gradient(135deg,var(--ok),#19bfa1);border-color:transparent}
.btn.warn{background:linear-gradient(135deg,var(--warn),#ff8e2f);border-color:transparent}
.help{font-size:.88rem;color:#cbd0e8}
.log{height:200px;overflow:auto;background:rgba(0,0,0,.25);border:1px dashed rgba(255,255,255,.12);border-radius:12px;padding:.6rem;
font-family:ui-monospace,Menlo,Consolas,monospace;font-size:.9rem;line-height:1.35}
footer{opacity:.8;text-align:center;margin:1.1rem 0 2rem}
hr{border:0;border-top:1px solid rgba(255,255,255,.08);margin:1rem 0}
.kbd{font-family:ui-monospace,Menlo,Consolas,monospace;background:rgba(255,255,255,.08);padding:0 .35rem;border-radius:.35rem}
</style>
</head>
<body>
  <div class="top">
    <div class="logo">
      <svg width="26" height="26" viewBox="0 0 24 24" fill="none"><path d="M12 2l2.39 4.847 5.35.777-3.87 3.77.913 5.324L12 14.77l-4.783 2.948.913-5.324-3.87-3.77 5.35-.777L12 2z" stroke="#8a5cff" stroke-width="1.2"/></svg>
      <span>F√™nix ‚Ä¢ Builder</span><span class="badge">Iara autom√°tica</span>
    </div>
  </div>

  <div class="shell grid two">
    <div class="card">
      <h2>Configurar aplicativo</h2>
      <div class="row" style="gap:1rem">
        <div style="flex:1">
          <label>Nome do App</label>
          <input id="appName" placeholder="Ex.: F√™nix">
        </div>
        <div style="flex:1">
          <label>Package (ID √∫nico)</label>
          <input id="pkg" placeholder="ex.: com.seuprojeto.fenix">
        </div>
      </div>

      <div class="row" style="gap:1rem;margin-top:.6rem">
        <div>
          <label>Modo</label>
          <select id="mode">
            <option value="weburl">WebView a partir de URL</option>
            <option value="assets">Assets locais (pasta HTML)</option>
          </select>
        </div>
        <div style="flex:1" id="urlWrap">
          <label>URL inicial (se usar WebView)</label>
          <input id="startUrl" placeholder="https://sua-pagina.exemplo">
        </div>
      </div>

      <div id="assetsWrap" style="display:none;margin-top:.6rem">
        <label>Assets HTML (opcional ‚Äì seleciona uma pasta)</label>
        <input id="assets" type="file" webkitdirectory directory multiple>
        <small>Se enviar assets, a WebView abrir√° <span class="kbd">file:///android_asset/index.html</span>.</small>
      </div>

      <div class="row" style="gap:1rem;margin-top:.6rem">
        <div>
          <label>√çcone (PNG 512√ó512)</label>
          <input id="icon" type="file" accept="image/png">
        </div>
        <div style="flex:1">
          <label>Vers√£o</label>
          <input id="ver" value="1.0.0">
        </div>
        <div>
          <label>Code</label>
          <input id="verCode" type="number" value="1" min="1">
        </div>
      </div>

      <hr/>
      <div class="row" style="justify-content:space-between">
        <div class="help">A Iara ajusta valores por comando. Ex.: <span class="kbd">‚ÄúIara, app se chama F√™nix‚Ä¶ pacote com.seu.fenix‚Ä¶ usar URL https://...‚Äù</span></div>
        <div class="row">
          <button class="btn" id="micBtn">üé§ Falar</button>
          <button class="btn primary" id="gen">Gerar Projeto (ZIP)</button>
        </div>
      </div>
    </div>

    <div class="card">
      <h2>Iara ‚Ä¢ comandos naturais</h2>
      <div class="row">
        <input id="cmd" placeholder='Ex.: "Iara, nome F√™nix, pacote com.exemplo.fenix, usar URL https://meusite", ou "usar assets"'>
        <button class="btn ok" id="runCmd">Executar</button>
      </div>
      <p class="help" style="margin:.6rem 0 0 0">Tamb√©m entende: <em>vers√£o 1.2.0</em>, <em>code 3</em>, <em>√≠cone</em> (use o seletor). Depois clique em <strong>Gerar Projeto (ZIP)</strong>.</p>
      <hr/>
      <div class="log" id="log"></div>
    </div>
  </div>

  <div class="shell">
    <div class="card">
      <h2>Como compilar no Termux (script incluso)</h2>
      <ol class="help">
        <li>Copie o ZIP para o Android e <strong>extraia</strong>.</li>
        <li>Abra o Termux na pasta do projeto e rode: <span class="kbd">bash scripts/build_termux.sh</span></li>
        <li>Primeira compila√ß√£o baixa SDK/AGP (pode demorar). Ao final, pegue o APK em <span class="kbd">app/build/outputs/apk/release/</span>.</li>
      </ol>
    </div>
    <footer class="help">F√™nix + Iara ‚Äî uma ferramenta, tr√™s modos. Feito com carinho. üíú</footer>
  </div>

  <!-- libs de zip/salvar -->
  <script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js"></script>

<script>
const $ = (s)=>document.querySelector(s);
const log = (m)=>{ const b=$("#log"); const t=new Date().toLocaleTimeString(); b.innerHTML += `[${t}] ${m}<br>`; b.scrollTop=b.scrollHeight; };

$("#mode").addEventListener("change", e=>{
  const useAssets = e.target.value==="assets";
  $("#assetsWrap").style.display = useAssets ? "block":"none";
  $("#urlWrap").style.display    = useAssets ? "none":"block";
});

function sanitizePkg(x){
  return (x||"").toLowerCase().replace(/[^a-z0-9_.]/g,"").replace(/^\.+|\.+$/g,"").replace(/\.+/g,".");
}
function asAppName(x){
  return (x||"F√™nix").replace(/[^\p{L}\p{N}\s\-_.]/gu,"").trim() || "F√™nix";
}

/* ===== Iara (comandos em PT-BR) ===== */
function handleCommand(raw){
  if(!raw) return;
  log("Voc√™: "+raw);
  let t = raw.toLowerCase();
  t = t.replace(/^iara[, ]*/,"").trim();

  // nome
  const nome = t.match(/nome\s+(.+?)(,|$)/) || t.match(/se chama\s+(.+?)(,|$)/) || t.match(/app\s+(.+?)(,|$)/);
  if(nome){ $("#appName").value = nome[1].trim(); log("Iara: nome ‚Üí "+$("#appName").value); }

  // pacote
  const pkg = t.match(/pacote\s+([a-z0-9_.]+)/) || t.match(/package\s+([a-z0-9_.]+)/);
  if(pkg){ $("#pkg").value = sanitizePkg(pkg[1]); log("Iara: package ‚Üí "+$("#pkg").value); }

  // vers√£o
  const ver = t.match(/vers[a√£]o\s+(\d+\.\d+\.\d+)/);
  if(ver){ $("#ver").value = ver[1]; log("Iara: vers√£o ‚Üí "+$("#ver").value); }

  // code
  const vc = t.match(/code\s+(\d+)/) || t.match(/c[o√≥]digo\s+(\d+)/);
  if(vc){ $("#verCode").value = parseInt(vc[1],10); log("Iara: versionCode ‚Üí "+$("#verCode").value); }

  // modo e URL
  if(t.includes("usar assets") || t.includes("assets")){ $("#mode").value="assets"; $("#assetsWrap").style.display="block"; $("#urlWrap").style.display="none"; log("Iara: modo ‚Üí assets locais"); }
  const urlm = t.match(/(url|abrir|usar)\s+(https?:\/\/\S+)/);
  if(urlm){ $("#mode").value="weburl"; $("#assetsWrap").style.display="none"; $("#urlWrap").style.display="block"; $("#startUrl").value=urlm[2]; log("Iara: URL ‚Üí "+$("#startUrl").value); }
}

$("#runCmd").onclick = ()=> handleCommand($("#cmd").value.trim());
$("#cmd").addEventListener("keydown", e=>{ if(e.key==="Enter") $("#runCmd").click(); });

/* Voz (se dispon√≠vel) */
let rec, listening=false;
(function voice(){
  const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
  if(!SR){ $("#micBtn").disabled = true; $("#micBtn").title="Navegador sem voz"; return; }
  rec = new SR(); rec.lang="pt-BR"; rec.interimResults=false; rec.maxAlternatives=1;
  rec.onresult = (e)=>{ const said=e.results[0][0].transcript; $("#cmd").value=said; log("üé§ "+said); handleCommand(said); };
  rec.onend = ()=>{ listening=false; $("#micBtn").textContent="üé§ Falar"; };
  rec.onerror = (e)=>{ listening=false; $("#micBtn").textContent="üé§ Falar"; log("‚ö†Ô∏è Voz: "+e.error); };
  $("#micBtn").onclick = ()=>{ if(listening){rec.stop();return;} listening=true; $("#micBtn").textContent="üõë Parar"; rec.start(); };
})();

/* ===== Gera√ß√£o do projeto (ZIP) ===== */
$("#gen").onclick = async ()=>{
  const name = asAppName($("#appName").value);
  const pkg  = sanitizePkg($("#pkg").value||"com.fenix.app");
  const ver  = $("#ver").value||"1.0.0";
  const vc   = parseInt($("#verCode").value||"1",10);
  const mode = $("#mode").value;
  const startUrl = $("#startUrl").value.trim() || "https://example.com";

  if(mode==="weburl" && !/^https?:\/\//i.test(startUrl)){
    log("‚ö†Ô∏è Informe uma URL v√°lida (http/https)."); return;
  }

  const zip = new JSZip();
  const root = zip.folder(name.replace(/\s+/g,"_") + "-android");

  // Arquivos de n√≠vel de projeto
  root.file("settings.gradle", `rootProject.name = "${name.replace(/"/g,'\\"')}"\ninclude(":app")\n`);
  root.file("gradle.properties", "org.gradle.jvmargs=-Xmx2g -Dfile.encoding=UTF-8\n");

  root.file("build.gradle", `buildscript {
    repositories { google(); mavenCentral() }
    dependencies { classpath 'com.android.tools.build:gradle:8.3.2' }
}
allprojects { repositories { google(); mavenCentral() } }
tasks.register("clean", Delete) { delete rootProject.buildDir }
`);

  // App module
  const app = root.folder("app");
  app.file("build.gradle", `
plugins { id 'com.android.application' }
android {
  namespace '${pkg}'
  compileSdk 34
  defaultConfig {
    applicationId '${pkg}'
    minSdk 24
    targetSdk 34
    versionCode ${vc}
    versionName '${ver}'
  }
  buildTypes {
    release {
      minifyEnabled true
      proguardFiles getDefaultProguardFile('proguard-android-optimize.txt'),'proguard-rules.pro'
    }
    debug { minifyEnabled false }
  }
  packaging { resources { excludes += ['META-INF/*'] } }
}
dependencies {
  implementation 'androidx.core:core-ktx:1.13.1'
  implementation 'androidx.appcompat:appcompat:1.7.0'
  implementation 'com.google.android.material:material:1.12.0'
}
`);

  app.file("proguard-rules.pro", "");

  // Manifest
  app.folder("src/main").file("AndroidManifest.xml", `<?xml version="1.0" encoding="utf-8"?>
<manifest package="${pkg}" xmlns:android="http://schemas.android.com/apk/res/android">
  <uses-permission android:name="android.permission.INTERNET"/>
  <application android:label="${name}" android:icon="@mipmap/ic_launcher" android:usesCleartextTraffic="true">
    <activity android:name=".MainActivity" android:exported="true">
      <intent-filter>
        <action android:name="android.intent.action.MAIN"/>
        <category android:name="android.intent.category.LAUNCHER"/>
      </intent-filter>
    </activity>
  </application>
</manifest>`);

  // Kotlin Activity (WebView)
  const isAssets = (mode==="assets");
  const loadLine = isAssets
    ? `web.loadUrl("file:///android_asset/index.html")`
    : `web.loadUrl("${startUrl.replace(/"/g,'\\"')}")`;

  app.folder("src/main/java/"+pkg.replace(/\./g,"/")).file("MainActivity.kt", `
package ${pkg}
import android.os.Bundle
import android.webkit.WebSettings
import android.webkit.WebView
import android.webkit.WebViewClient
import androidx.appcompat.app.AppCompatActivity

class MainActivity: AppCompatActivity() {
  override fun onCreate(savedInstanceState: Bundle?) {
    super.onCreate(savedInstanceState)
    val web = WebView(this)
    setContentView(web)
    with(web.settings){
      javaScriptEnabled = true
      domStorageEnabled = true
      mixedContentMode = WebSettings.MIXED_CONTENT_ALWAYS_ALLOW
      useWideViewPort = true
      loadWithOverviewMode = true
      mediaPlaybackRequiresUserGesture = false
    }
    web.webViewClient = object: WebViewClient() {}
    ${loadLine}
  }
  override fun onBackPressed() {
    val w = (this.findViewById(android.R.id.content) as android.view.ViewGroup).getChildAt(0) as WebView
    if(w.canGoBack()) w.goBack() else super.onBackPressed()
  }
}
`);

  // Layout opcional (usando WebView direto na Activity, simples)
  const res = app.folder("src/main/res");
  res.folder("mipmap-anydpi-v26").file("ic_launcher.xml",
`<?xml version="1.0" encoding="utf-8"?>
<adaptive-icon xmlns:android="http://schemas.android.com/apk/res/android">
  <background android:drawable="@color/ic_launcher_bg"/>
  <foreground android:drawable="@drawable/ic_launcher_foreground"/>
</adaptive-icon>`);

  res.folder("values").file("colors.xml", `<?xml version="1.0" encoding="utf-8"?><resources><color name="ic_launcher_bg">#111219</color></resources>`);

  // √çcone (usa PNG enviado como foreground ‚Äúbruto‚Äù)
  const drawable = res.folder("drawable");
  const iconFile = $("#icon").files[0];
  if(iconFile){
    const buf = await iconFile.arrayBuffer();
    drawable.file("ic_launcher_foreground.png", buf);
  } else {
    // √≠cone fallback simples (SVG convertido em XML-Vector? ‚Äì vamos cair para um PNG m√≠nimo embutido)
    const png1x1 = atob("iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAwMB/erwfnkAAAAASUVORK5CYII=");
    drawable.file("ic_launcher_foreground.png", new Uint8Array([...png1x1].map(c=>c.charCodeAt(0))));
  }

  // Assets locais (se houver)
  if(isAssets){
    const assets = app.folder("src/main/assets");
    const files = $("#assets").files;
    if(files && files.length){
      for(const f of files){
        const path = ("assets/"+f.webkitRelativePath.replace(/^.*?\//,"")).replace(/^assets\//,"");
        const data = await f.arrayBuffer();
        assets.file(path, data);
      }
    } else {
      // √≠ndice m√≠nimo se nenhum asset enviado
      app.folder("src/main/assets").file("index.html",
`<!doctype html><html><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>${name}</title><body style="font-family:system-ui;background:#0b0b10;color:#e9e9ff">
<h1 style="font-weight:700">${name}</h1><p>Seu app de assets est√° pronto. Substitua este <code>index.html</code>.</p></body></html>`);
    }
  }

  // Script Termux
  const scripts = root.folder("scripts");
  scripts.file("build_termux.sh", `#!/data/data/com.termux/files/usr/bin/bash
set -e
echo "[F√™nix] Atualizando Termux e instalando depend√™ncias..."
pkg update -y && pkg upgrade -y
pkg install -y openjdk-17 gradle wget unzip git
export JAVA_HOME=$(dirname $(dirname $(readlink -f $(which javac)))) || true

# Android SDK
export ANDROID_HOME=$HOME/android-sdk
export ANDROID_SDK_ROOT=$ANDROID_HOME
export PATH=$ANDROID_HOME/cmdline-tools/latest/bin:$ANDROID_HOME/platform-tools:$PATH

mkdir -p "$ANDROID_HOME"
cd "$ANDROID_HOME"
if [ ! -d cmdline-tools ]; then
  echo "[F√™nix] Baixando Android cmdline-tools..."
  wget -q https://dl.google.com/android/repository/commandlinetools-linux-11076708_latest.zip -O cmdtools.zip
  mkdir -p cmdline-tools && unzip -q cmdtools.zip -d cmdline-tools-tmp
  mkdir -p cmdline-tools/latest
  mv cmdline-tools-tmp/cmdline-tools/* cmdline-tools/latest/
  rm -rf cmdline-tools-tmp cmdtools.zip
fi

yes | sdkmanager --sdk_root="$ANDROID_HOME" --licenses
sdkmanager --sdk_root="$ANDROID_HOME" "platform-tools" "platforms;android-34" "build-tools;34.0.0"

echo "[F√™nix] Criando local.properties..."
cd "$(dirname "$0")/.."
echo "sdk.dir=$ANDROID_HOME" > local.properties

echo "[F√™nix] Gerando Gradle Wrapper..."
gradle wrapper --gradle-version 8.7

echo "[F√™nix] Compilando APK (assembleRelease)..."
./gradlew --no-daemon assembleRelease

echo "[F√™nix] OK! Arquivo em: app/build/outputs/apk/release/"
`);

  // README
  root.file("README.txt", `F√äNIX ‚Äì BUILDER
=================
App: ${name}
Package: ${pkg}
Vers√£o: ${ver} (${vc})
Modo: ${mode}${mode==="weburl" ? `\nURL: ${startUrl}` : `\nAssets: src/main/assets`}

Como compilar no Termux:
1) No Android, instale Termux. Copie e extraia este ZIP.
2) Abra Termux na pasta do projeto e rode:
   bash scripts/build_termux.sh
3) Aguarde a instala√ß√£o de SDK/AGP (primeira vez √© mais demorada).
4) APK pronto em: app/build/outputs/apk/release/

Observa√ß√£o: voc√™ pode abrir e editar este projeto no Android Studio tamb√©m.
`);

  // Compactar
  log("üì¶ Gerando ZIP do projeto...");
  const blob = await root.generateAsync({type:"blob"});
  saveAs(blob, `${name.replace(/\s+/g,"_")}-android.zip`);
  log("‚úÖ Projeto gerado. Agora √© s√≥ compilar no Termux usando o script incluso.");
};
</script>
</body>
  </html>
