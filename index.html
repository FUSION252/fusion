<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>F√™nix ‚Ä¢ Iara Player</title>
<meta name="theme-color" content="#0b0b0e">
<style>
  :root{
    --bg:#0b0b0e; --card:#121219; --ink:#e9e9f2; --muted:#a7a7bd;
    --glow: rgba(138,92,255,.55); --accent:#8a5cff; --accent2:#43d3b6; --danger:#ff5c7a;
  }
  *{ box-sizing:border-box }
  html,body{ height:100%; }
  body{
    margin:0; font-family:ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, "Helvetica Neue", Arial;
    background: radial-gradient(1200px 600px at 20% -10%, rgba(138,92,255,.12), transparent 60%),
                radial-gradient(1200px 600px at 120% 10%, rgba(67,211,182,.10), transparent 60%),
                #0b0b0e;
    color:var(--ink);
  }
  .topbar{
    position:sticky; top:0; z-index:50; display:flex; align-items:center; justify-content:space-between;
    padding:.9rem 1rem; background:rgba(10,10,16,.86); backdrop-filter: blur(8px);
    border-bottom:1px solid rgba(255,255,255,.06)
  }
  .brand{ display:flex; align-items:center; gap:.6rem; font-weight:700; letter-spacing:.25px }
  .brand .dot{
    width:22px; height:22px; border-radius:6px;
    background: conic-gradient(from 200deg, var(--accent), #6b44ff 40%, #4f39f7 60%);
    box-shadow: 0 0 18px var(--glow), inset 0 0 12px rgba(255,255,255,.14);
  }
  .shell{ max-width:1120px; margin:1.1rem auto; padding:0 1rem; }
  .card{
    background:linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,.00));
    border:1px solid rgba(255,255,255,.07); border-radius:18px; overflow:hidden;
    box-shadow:0 18px 40px rgba(0,0,0,.35)
  }
  .player-wrap{ position:relative; aspect-ratio:16/9; background:#000 }
  #player{ position:absolute; inset:0; }
  .controls{
    display:flex; flex-wrap:wrap; gap:.6rem; align-items:center; justify-content:space-between;
    padding:.8rem .9rem; border-top:1px solid rgba(255,255,255,.06); background:rgba(0,0,0,.18)
  }
  .row{ display:flex; flex-wrap:wrap; gap:.6rem; align-items:center }
  .btn{
    display:inline-flex; align-items:center; gap:.45rem; font-weight:600;
    padding:.6rem .9rem; border:1px solid rgba(255,255,255,.08);
    background:rgba(255,255,255,.03); color:var(--ink); border-radius:12px; cursor:pointer;
    transition: .15s ease; user-select:none;
  }
  .btn:hover{ background:rgba(255,255,255,.07) }
  .btn:active{ transform:translateY(1px) }
  .btn.primary{ background:linear-gradient(135deg,var(--accent),#6b44ff); border-color:transparent; }
  .btn.danger{ background:linear-gradient(135deg,var(--danger),#ff2f66); border-color:transparent; }
  .input{
    flex:1; min-width:240px; display:flex; align-items:center; gap:.55rem;
    background:rgba(255,255,255,.04); border:1px solid rgba(255,255,255,.08);
    border-radius:12px; padding:.55rem .75rem;
  }
  .input input{
    flex:1; background:transparent; border:0; outline:0; color:var(--ink); font-size:.98rem;
  }
  .muted{ color:var(--muted); font-size:.88rem }
  .grid{ display:grid; gap:1rem; margin-top:1rem }
  @media(min-width:900px){ .grid{ grid-template-columns:1.35fr .65fr } }
  .panel{ background:rgba(255,255,255,.02); border:1px solid rgba(255,255,255,.06); border-radius:18px; padding:1rem }
  .panel h3{ margin:.2rem 0 .7rem 0; font-size:1rem; color:#dde0ff }
  .log{
    height:190px; overflow:auto; background:rgba(0,0,0,.25);
    border:1px dashed rgba(255,255,255,.12); border-radius:12px; padding:.65rem;
    font-family:ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; font-size:.9rem; line-height:1.35; color:#d9e2ff;
  }
  .footer{ text-align:center; opacity:.75; margin:1rem 0 2rem }
</style>
</head>
<body>
  <header class="topbar">
    <div class="brand">
      <span class="dot"></span>
      <span>F√™nix</span>
    </div>
    <span class="muted">Iara ativada</span>
  </header>

  <main class="shell">
    <section class="card">
      <div class="player-wrap"><div id="player" aria-label="reprodutor de v√≠deo"></div></div>
      <div class="controls">
        <div class="row">
          <button class="btn" id="prevBtn">‚èÆÔ∏è</button>
          <button class="btn primary" id="playBtn">‚ñ∂Ô∏è</button>
          <button class="btn" id="pauseBtn">‚è∏Ô∏è</button>
          <button class="btn" id="nextBtn">‚è≠Ô∏è</button>
          <button class="btn" id="muteBtn">üîá</button>
          <label class="muted" style="display:flex;align-items:center;gap:.5rem">üîä
            <input type="range" id="vol" min="0" max="100" value="80" />
            <span id="volVal" class="muted">80%</span>
          </label>
          <button class="btn" id="fsBtn">‚õ∂</button>
        </div>
        <div class="row" style="flex:1">
          <div class="input" title="Buscar no YouTube e tocar aqui">
            <span>üîé</span>
            <input id="search" placeholder="Buscar e tocar (ex.: m√∫sicas relaxantes)" autocomplete="off" />
          </div>
          <button class="btn" id="searchBtn">Buscar</button>
        </div>
      </div>
    </section>

    <section class="grid">
      <div class="panel">
        <h3>Iara (texto/voz)</h3>
        <div class="row">
          <div class="input" title='Ex.: "Iara, tocar Legi√£o Urbana", "Iara, volume 60"'>
            <span>üí¨</span>
            <input id="cmd" placeholder='Diga: "Iara, tocar rock nacional"‚Ä¶' />
          </div>
          <button class="btn" id="runCmd">Executar</button>
          <button class="btn" id="micBtn">üé§ Falar</button>
        </div>
        <p class="muted" style="margin:.6rem 0 0 0">
          Comandos: <em>Iara, tocar &lt;termo&gt;</em> ‚Ä¢ <em>Iara, pausar</em> ‚Ä¢ <em>Iara, pr√≥ximo</em> ‚Ä¢
          <em>Iara, anterior</em> ‚Ä¢ <em>Iara, volume 40</em> ‚Ä¢ <em>Iara, tela cheia</em>.
        </p>
      </div>
      <div class="panel">
        <h3>Status</h3>
        <div id="log" class="log" aria-live="polite"></div>
      </div>
    </section>

    <p class="footer muted">Feito pra voc√™, com amor. üíú</p>
  </main>

  <!-- ===== L√≥gica ===== -->
  <script>
    // Util
    const $ = (s)=>document.querySelector(s);
    const log = (m)=>{ const b=$("#log"); const t=new Date().toLocaleTimeString(); b.innerHTML += `[${t}] ${m}<br/>`; b.scrollTop=b.scrollHeight; };

    // Estado
    let player, isMuted=false, currentQuery="m√∫sicas relaxantes";

    // YouTube IFrame API
    function onYouTubeIframeAPIReady(){
      player = new YT.Player('player', {
        height: '100%', width:'100%',
        playerVars:{
          modestbranding:1, rel:0, controls:1, fs:1, iv_load_policy:3,
          color:'white', listType:'search', list: currentQuery
        },
        events:{
          onReady: onPlayerReady,
          onError: e=>log("Erro do player: "+e.data)
        }
      });
    }
    function onPlayerReady(){
      try{ player.setVolume(80); }catch(_){}
      log("Player pronto. Pesquisando: " + currentQuery);
    }

    // Controles
    $("#playBtn").onclick = ()=>{ try{ player.playVideo(); log("‚ñ∂Ô∏è Reproduzir"); }catch(_){} };
    $("#pauseBtn").onclick= ()=>{ try{ player.pauseVideo(); log("‚è∏Ô∏è Pausar"); }catch(_){ } };
    $("#nextBtn").onclick = ()=>{ try{ player.nextVideo(); log("‚è≠Ô∏è Pr√≥ximo"); }catch(_){ } };
    $("#prevBtn").onclick = ()=>{ try{ player.previousVideo(); log("‚èÆÔ∏è Anterior"); }catch(_){ } };
    $("#muteBtn").onclick = ()=>{
      if(!player) return;
      if(isMuted){ player.unMute(); log("üîä Som ativado"); }
      else{ player.mute(); log("üîá Som desativado"); }
      isMuted=!isMuted;
    };
    $("#vol").oninput = (e)=>{ const v=+e.target.value; $("#volVal").textContent=v+"%"; try{ player.setVolume(v); }catch(_){} };
    $("#fsBtn").onclick = ()=>{
      const el = document.querySelector(".player-wrap");
      if(document.fullscreenElement){ document.exitFullscreen(); }
      else{ el.requestFullscreen?.(); }
    };

    // Busca
    function searchAndPlay(q){
      if(!q || !player) return;
      currentQuery = q;
      try{
        player.loadPlaylist({ listType:'search', list:q, index:0, startSeconds:0, suggestedQuality:'default' });
        log("üîé Tocando resultados para: " + q);
      }catch(err){ log("Falha ao trocar playlist: "+err.message); }
    }
    $("#searchBtn").onclick = ()=> searchAndPlay($("#search").value.trim());
    $("#search").addEventListener('keydown', e=>{ if(e.key==='Enter') $("#searchBtn").click(); });

    // Iara (texto)
    $("#runCmd").onclick = ()=> handleCommand( $("#cmd").value.trim() );
    $("#cmd").addEventListener('keydown', e=>{ if(e.key==='Enter') $("#runCmd").click(); });

    function handleCommand(raw){
      if(!raw){ log("Iara: me diga o que tocar üíú"); return; }
      const txt = raw.toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g,'').trim();
      log("Voc√™: " + raw);
      const cleaned = txt.replace(/^iara[, ]*/,'').trim();

      if(/^(pausa|pausar|stop|parar)$/.test(cleaned)){ player?.pauseVideo(); log("Iara: pausando."); return; }
      if(/^(play|reproduzir)$/.test(cleaned)){ player?.playVideo(); log("Iara: reproduzindo."); return; }
      if(cleaned.includes("proximo")){ player?.nextVideo(); log("Iara: pr√≥ximo v√≠deo."); return; }
      if(cleaned.includes("anterior") || cleaned.includes("voltar")){ player?.previousVideo(); log("Iara: v√≠deo anterior."); return; }
      if(cleaned.includes("tela cheia")){ $("#fsBtn").click(); log("Iara: tela cheia."); return; }

      const vol = cleaned.match(/volume\s*(\d{1,3})/);
      if(vol){
        let v = Math.max(0, Math.min(100, parseInt(vol[1],10)));
        $("#vol").value=v; $("#volVal").textContent=v+"%"; player?.setVolume(v);
        log(`Iara: volume em ${v}%.`); return;
      }

      // "tocar X" / "reproduzir X"
      const m = cleaned.match(/\b(tocar|reproduzir)\b\s*(.+)?/);
      if(m && m[2]){ searchAndPlay(m[2]); log(`Iara: procurando ‚Äú${m[2]}‚Äù.`); return; }

      // "abrir <id/url>"
      if(cleaned.startsWith("abrir ")){
        const rest = cleaned.replace("abrir","").trim();
        const id = extractYouTubeId(rest);
        if(id){ player?.loadVideoById(id); log("Iara: abrindo v√≠deo."); }
        else { searchAndPlay(rest); }
        return;
      }

      // fallback: trata como busca
      searchAndPlay(cleaned);
      log(`Iara: entendi como busca por ‚Äú${cleaned}‚Äù.`);
    }

    function extractYouTubeId(text){
      try{
        const u = new URL(text);
        if(u.hostname.includes("youtube.com")) return u.searchParams.get("v");
        if(u.hostname.includes("youtu.be")) return u.pathname.slice(1);
      }catch(_){}
      if(/^[\w-]{11}$/.test(text)) return text;
      return null;
    }

    // Iara (voz)
    let rec, listening=false;
    const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
    if(SR){
      rec = new SR(); rec.lang='pt-BR'; rec.interimResults=false; rec.maxAlternatives=1;
      rec.onresult = (e)=>{ const said=e.results[0][0].transcript; $("#cmd").value=said; log("üé§ "+said); handleCommand(said); };
      rec.onend = ()=>{ listening=false; $("#micBtn").textContent="üé§ Falar"; };
      rec.onerror = (e)=>{ listening=false; $("#micBtn").textContent="üé§ Falar"; log("‚ö†Ô∏è Voz: "+e.error); };
      $("#micBtn").onclick = ()=>{
        if(listening){ rec.stop(); return; }
        listening=true; $("#micBtn").textContent="üõë Parar"; log("üé§ Ouvindo‚Ä¶");
        try{ rec.start(); }catch(_){ listening=false; $("#micBtn").textContent="üé§ Falar"; }
      };
    } else {
      $("#micBtn").disabled=true; $("#micBtn").title="Reconhecimento de voz n√£o suportado";
    }

    // Carregar API YouTube
    (function loadYT(){
      const s=document.createElement('script');
      s.src="https://www.youtube.com/iframe_api";
      document.head.appendChild(s);
    })();
  </script>
</body>
</html>
