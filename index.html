<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>F√™nix ‚Ä¢ Iara Player</title>
<meta name="theme-color" content="#0b0b0e" />
<style>
  :root{--bg:#0b0b0e;--card:#121219;--ink:#e9e9f4;--muted:#a7a7bd;--accent:#8a5cff;--danger:#ff5c7a}
  *{box-sizing:border-box} body{margin:0;background:#0a0a10;color:var(--ink);
    font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial}
  .wrap{max-width:980px;margin:0 auto;padding:16px}
  .bar{position:sticky;top:0;z-index:20;background:rgba(10,10,16,.9);backdrop-filter:blur(6px);
    border-bottom:1px solid rgba(255,255,255,.06);padding:12px 16px;display:flex;align-items:center;gap:10px}
  .brand{display:flex;align-items:center;gap:10px;font-weight:700}
  .brand svg{filter:drop-shadow(0 4px 14px rgba(138,92,255,.45))}
  .tag{font-size:.75rem;padding:.15rem .5rem;border-radius:999px;background:rgba(138,92,255,.18);color:#d7c9ff}
  .card{background:var(--card);border:1px solid rgba(255,255,255,.06);border-radius:16px;overflow:hidden;
    box-shadow:0 10px 28px rgba(0,0,0,.35)}
  .stage{position:relative;aspect-ratio:16/9;background:#000}
  #player{position:absolute;inset:0}
  .controls{display:flex;flex-wrap:wrap;gap:8px;align-items:center;justify-content:space-between;
    padding:10px;border-top:1px solid rgba(255,255,255,.06);background:rgba(0,0,0,.25)}
  .row{display:flex;flex-wrap:wrap;gap:8px;align-items:center}
  .btn{display:inline-flex;align-items:center;gap:6px;padding:.55rem .8rem;border-radius:12px;
    border:1px solid rgba(255,255,255,.08);background:rgba(255,255,255,.03);color:var(--ink);cursor:pointer}
  .btn:hover{background:rgba(255,255,255,.07)} .btn.primary{background:linear-gradient(135deg,var(--accent),#6b44ff);border-color:transparent}
  .input{flex:1;min-width:220px;display:flex;align-items:center;gap:.5rem;background:rgba(255,255,255,.04);
    border:1px solid rgba(255,255,255,.08);border-radius:12px;padding:.5rem .7rem}
  .input input{flex:1;background:transparent;border:0;outline:0;color:var(--ink);font-size:.95rem}
  .hint{color:var(--muted);font-size:.85rem}
  .panels{display:grid;gap:12px;margin-top:12px} @media(min-width:900px){.panels{grid-template-columns:1.3fr .7fr}}
  .panel{background:var(--card);border:1px solid rgba(255,255,255,.06);border-radius:16px;padding:12px}
  .panel h3{margin:4px 0 10px 0;font-size:1rem;color:#dcdcf3}
  .log{height:170px;overflow:auto;background:rgba(0,0,0,.25);border:1px dashed rgba(255,255,255,.12);
    border-radius:12px;padding:.6rem;font-family:ui-monospace,Menlo,Consolas,monospace;font-size:.9rem;line-height:1.35;color:#d9e2ff}
  .footer{opacity:.7;text-align:center;margin:14px 0}
  .vol{display:flex;align-items:center;gap:6px} input[type="range"]{width:140px}
</style>
</head>
<body>
  <div class="bar">
    <div class="brand">
      <svg width="26" height="26" viewBox="0 0 24 24" fill="none"><path d="M12 2l2.39 4.85 5.35.78-3.87 3.77.91 5.33L12 14.8 7.22 16.73l.91-5.33-3.87-3.77 5.35-.78L12 2z" stroke="#8a5cff" stroke-width="1.2"/></svg>
      <span>F√™nix</span><span class="tag">Iara</span>
    </div>
  </div>

  <div class="wrap">
    <div class="card">
      <div class="stage"><div id="player"></div></div>
      <div class="controls">
        <div class="row">
          <button class="btn" id="prev">‚èÆÔ∏è</button>
          <button class="btn primary" id="play">‚ñ∂Ô∏è</button>
          <button class="btn" id="pause">‚è∏Ô∏è</button>
          <button class="btn" id="next">‚è≠Ô∏è</button>
          <button class="btn" id="mute">üîá</button>
          <div class="vol"><span class="hint">üîä</span><input type="range" id="vol" min="0" max="100" value="80"><span class="hint" id="volVal">80%</span></div>
          <button class="btn" id="fs">‚õ∂</button>
        </div>
        <div class="row" style="flex:1">
          <div class="input"><span>üîé</span><input id="q" placeholder="Buscar e tocar (ex.: m√∫sicas relaxantes)"></div>
          <button class="btn" id="go">Buscar & Tocar</button>
        </div>
      </div>
    </div>

    <div class="panels">
      <div class="panel">
        <h3>Iara ‚Äî comandos por texto/voz</h3>
        <div class="row">
          <div class="input"><span>üí¨</span><input id="cmd" placeholder='Ex.: "Iara, tocar rock nacional" ‚Ä¢ "Iara, pausar" ‚Ä¢ "Iara, pr√≥ximo" ‚Ä¢ "Iara, volume 60"' /></div>
          <button class="btn" id="run">Executar</button>
          <button class="btn" id="mic">üé§ Falar</button>
        </div>
        <p class="hint" style="margin:.6rem 0 0 0">Dicas: <em>Iara, tocar Legi√£o Urbana</em> ‚Ä¢ <em>Iara, pausar</em> ‚Ä¢ <em>Iara, pr√≥ximo</em> ‚Ä¢ <em>Iara, anterior</em> ‚Ä¢ <em>Iara, volume 40</em></p>
      </div>
      <div class="panel">
        <h3>Status</h3>
        <div id="log" class="log"></div>
      </div>
    </div>

    <div class="footer hint">Feito com carinho ‚Ä¢ F√™nix + Iara üíú</div>
  </div>

  <script>
    // Util
    const $ = s => document.querySelector(s);
    const log = m => { const box=$("#log"); const t=new Date().toLocaleTimeString(); box.innerHTML+=`[${t}] ${m}<br>`; box.scrollTop=box.scrollHeight; };

    // Player
    let player, isMuted=false, currentQuery="m√∫sicas relaxantes";
    function onYouTubeIframeAPIReady(){
      player = new YT.Player('player', {
        height:'100%', width:'100%',
        playerVars:{modestbranding:1, rel:0, controls:1, fs:1, iv_load_policy:3, color:'white', listType:'search', list: currentQuery},
        events:{ onReady: onReady, onError: e=>log("Erro do player: "+e.data) }
      });
    }
    function onReady(){ log("Player pronto. Clique ‚ñ∂Ô∏è para iniciar."); player.setVolume(80); }

    // Controles
    $("#play").onclick = ()=>{ player?.playVideo(); log("‚ñ∂Ô∏è Reproduzir"); };
    $("#pause").onclick= ()=>{ player?.pauseVideo(); log("‚è∏Ô∏è Pausar"); };
    $("#next").onclick = ()=>{ player?.nextVideo(); log("‚è≠Ô∏è Pr√≥ximo"); };
    $("#prev").onclick = ()=>{ player?.previousVideo(); log("‚èÆÔ∏è Anterior"); };
    $("#mute").onclick = ()=>{
      if(!player) return;
      isMuted ? (player.unMute(), log("üîä Som ativado")) : (player.mute(), log("üîá Mudo"));
      isMuted=!isMuted;
    };
    $("#vol").oninput = e=>{ const v=+e.target.value; $("#volVal").textContent=v+"%"; player?.setVolume(v); };
    $("#fs").onclick = ()=>{
      const el = document.querySelector(".stage");
      if(document.fullscreenElement) document.exitFullscreen();
      else el.requestFullscreen?.();
    };

    // Busca
    function searchAndPlay(q){
      if(!q || !player) return;
      currentQuery=q;
      player.loadPlaylist({ listType:'search', list:q, index:0, startSeconds:0, suggestedQuality:'default' });
      log("üîé Tocando resultados para: "+q);
    }
    $("#go").onclick = ()=> searchAndPlay( $("#q").value.trim() );
    $("#q").addEventListener('keydown', e=>{ if(e.key==='Enter') $("#go").click(); });

    // Comandos Iara (texto)
    $("#run").onclick = ()=> handleCmd( $("#cmd").value.trim() );
    $("#cmd").addEventListener('keydown', e=>{ if(e.key==='Enter') $("#run").click(); });

    function handleCmd(raw){
      if(!raw){ log("Iara: diga algo como ‚ÄúIara, tocar ‚Ä¶‚Äù"); return; }
      log("Voc√™: "+raw);
      const txt = raw.toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g,'').trim();
      const s = txt.replace(/^iara[, ]*/,'').trim();

      if(/^paus(ar)?$/.test(s) || s.includes("pausar")){ player?.pauseVideo(); log("Iara: pausando."); return; }
      if(s.includes("proximo") || s.includes("pr√≥ximo")){ player?.nextVideo(); log("Iara: pr√≥ximo v√≠deo."); return; }
      if(s.includes("anterior") || s.includes("voltar")){ player?.previousVideo(); log("Iara: v√≠deo anterior."); return; }

      const vol = s.match(/volume\s*(\d{1,3})/);
      if(vol){ let v=Math.max(0,Math.min(100,parseInt(vol[1],10))); player?.setVolume(v); $("#vol").value=v; $("#volVal").textContent=v+"%"; log(`Iara: volume em ${v}%.`); return; }

      // "tocar X" / "reproduzir X" / "abrir <id/url>"
      if(s.startsWith("abrir ")){
        const rest = s.replace("abrir","").trim();
        const id = extractYouTubeId(rest);
        if(id){ player?.loadVideoById(id); log("Iara: abrindo v√≠deo solicitado."); return; }
      }
      const m = s.match(/^(tocar|reproduzir)\s+(.+)$/);
      if(m){ searchAndPlay(m[2].trim()); log(`Iara: procurando ‚Äú${m[2].trim()}‚Äù.`); return; }

      // fallback: tratar como busca
      searchAndPlay(s);
      log(`Iara: buscando ‚Äú${s}‚Äù.`);
    }

    function extractYouTubeId(text){
      try{
        const u = new URL(text);
        if(u.hostname.includes("youtube.com")) return u.searchParams.get("v");
        if(u.hostname.includes("youtu.be")) return u.pathname.slice(1);
      }catch(_){}
      if(/^[\w-]{11}$/.test(text)) return text;
      return null;
    }

    // Voz (HTTPS necess√°rio)
    let rec, listening=false;
    (function initVoice(){
      const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
      if(!SR){ $("#mic").disabled=true; $("#mic").title="Sem suporte de voz"; return; }
      rec = new SR(); rec.lang='pt-BR'; rec.interimResults=false; rec.maxAlternatives=1;
      rec.onresult = e=>{ const said=e.results[0][0].transcript; $("#cmd").value=said; log("üé§ Voc√™: "+said); handleCmd(said); };
      rec.onend = ()=>{ listening=false; $("#mic").textContent="üé§ Falar"; log("üé§ microfone parado."); };
      rec.onerror = e=>{ listening=false; $("#mic").textContent="üé§ Falar"; log("‚ö†Ô∏è Voz: "+e.error); };
    })();
    $("#mic").onclick = ()=>{
      if(!rec){ log("‚ö†Ô∏è Voz n√£o suportada neste navegador."); return; }
      if(listening){ rec.stop(); return; }
      listening=true; $("#mic").textContent="üõë Parar"; log("üé§ ouvindo‚Ä¶");
      rec.start();
    };

    // Carrega API do YouTube
    (function loadYT(){
      const s = document.createElement('script');
      s.src="https://www.youtube.com/iframe_api";
      document.head.appendChild(s);
    })();
  </script>
</body>
</html>
